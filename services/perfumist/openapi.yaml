openapi: 3.1.3
info:
  title: Perfumist API
  description: API для получения рекомендаций по духам
  version: 1.0.0
servers:
  - url: http://localhost:8000
    description: Локальный сервер разработки
  - url: http://perfumist:8000
    description: Production сервер

paths:
  /v2/perfume/suggest:
    get:
      summary: Получить рекомендации по духам
      description: Возвращает список похожих духов на основе переданных параметров, используя алгоритмический подход
      operationId: suggestPerfume
      tags:
        - Suggestions
      security:
        - BearerAuth: []
      parameters:
        - name: brand
          in: query
          required: true
          description: Бренд духов
          schema:
            type: string
            example: "Chanel"
        - name: name
          in: query
          required: true
          description: Название духов
          schema:
            type: string
            example: "No. 5"
        - name: sex
          in: query
          required: false
          description: Пол (male, female, unisex)
          schema:
            type: string
            enum: [male, female, unisex]
            default: unisex
            example: "female"
      responses:
        "200":
          description: Успешно получены рекомендации
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuggestResponse"
              example:
                suggested:
                  - perfume:
                      brand: "Dior"
                      name: "Sauvage"
                      sex: "male"
                      image_url: "https://example.com/image.jpg"
                      properties:
                        perfume_type: "EDT"
                        family: ["Fresh", "Spicy"]
                        upper_notes: ["Bergamot", "Pepper"]
                        core_notes: ["Lavender", "Pink Pepper"]
                        base_notes: ["Ambroxan", "Cedar"]
                      shops: []
                    rank: 1
                    similarity_score: 0.95
                  - perfume:
                      brand: "Tom Ford"
                      name: "Oud Wood"
                      sex: "male"
                      image_url: "https://example.com/image2.jpg"
                      properties:
                        perfume_type: "EDP"
                        family: ["Woody", "Oriental"]
                        upper_notes: ["Rosewood"]
                        core_notes: ["Oud"]
                        base_notes: ["Sandalwood", "Vanilla"]
                      shops: []
                    rank: 2
                    similarity_score: 0.88
        "400":
          description: Неверные параметры запроса (отсутствует brand или name)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                error: "Brand and name are required"
        "403":
          description: Ошибка авторизации (отсутствует или неверный токен)
          content:
            text/plain:
              schema:
                type: string
              example: "authentication error: missing or invalid authorization header"
        "404":
          description: Духи не найдены
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                error: "perfume not found"
        "500":
          description: Ошибка взаимодействия с другими сервисами
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                error: "failed to interact with perfume service"

  /v2/perfume/ai-suggest:
    get:
      summary: Получить рекомендации по духам с использованием AI
      description: Возвращает список похожих духов на основе переданных параметров, используя искусственный интеллект для анализа и рекомендаций
      operationId: aiSuggestPerfume
      tags:
        - Suggestions
      security:
        - BearerAuth: []
      parameters:
        - name: brand
          in: query
          required: true
          description: Бренд духов
          schema:
            type: string
            example: "Chanel"
        - name: name
          in: query
          required: true
          description: Название духов
          schema:
            type: string
            example: "No. 5"
        - name: sex
          in: query
          required: false
          description: Пол (male, female, unisex)
          schema:
            type: string
            enum: [male, female, unisex]
            default: unisex
            example: "female"
      responses:
        "200":
          description: Успешно получены рекомендации
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuggestResponse"
              example:
                suggested:
                  - perfume:
                      brand: "Dior"
                      name: "Sauvage"
                      sex: "male"
                      image_url: "https://example.com/image.jpg"
                      properties:
                        perfume_type: "EDT"
                        family: ["Fresh", "Spicy"]
                        upper_notes: ["Bergamot", "Pepper"]
                        core_notes: ["Lavender", "Pink Pepper"]
                        base_notes: ["Ambroxan", "Cedar"]
                      shops: []
                    rank: 1
                    similarity_score: 0.95
                  - perfume:
                      brand: "Tom Ford"
                      name: "Oud Wood"
                      sex: "male"
                      image_url: "https://example.com/image2.jpg"
                      properties:
                        perfume_type: "EDP"
                        family: ["Woody", "Oriental"]
                        upper_notes: ["Rosewood"]
                        core_notes: ["Oud"]
                        base_notes: ["Sandalwood", "Vanilla"]
                      shops: []
                    rank: 2
                    similarity_score: 0.88
        "400":
          description: Неверные параметры запроса (отсутствует brand или name)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                error: "Brand and name are required"
        "403":
          description: Ошибка авторизации (отсутствует или неверный токен)
          content:
            text/plain:
              schema:
                type: string
              example: "authentication error: missing or invalid authorization header"
        "404":
          description: Духи не найдены
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                error: "perfume not found"
        "500":
          description: Ошибка взаимодействия с другими сервисами
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                error: "failed to interact with perfume service"

  /v2/perfume/suggest-by-tags:
    get:
      summary: Получить рекомендации по духам на основе тегов
      description: Возвращает список похожих духов на основе переданных тегов
      operationId: suggestPerfumeByTags
      tags:
        - Suggestions
      security:
        - BearerAuth: []
      parameters:
        - name: tags
          in: query
          required: true
          description: Теги для поиска (разделенные запятой)
          schema:
            type: string
            example: "fresh,spicy,woody"
        - name: sex
          in: query
          required: false
          description: Пол (male, female, unisex)
          schema:
            type: string
            enum: [male, female, unisex]
            default: unisex
            example: "male"
      responses:
        "200":
          description: Успешно получены рекомендации
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuggestResponse"
              example:
                suggested:
                  - perfume:
                      brand: "Dior"
                      name: "Sauvage"
                      sex: "male"
                      image_url: "https://example.com/image.jpg"
                      properties:
                        perfume_type: "EDT"
                        family: ["Fresh", "Spicy"]
                        upper_notes: ["Bergamot", "Pepper"]
                        core_notes: ["Lavender", "Pink Pepper"]
                        base_notes: ["Ambroxan", "Cedar"]
                      shops: []
                    rank: 1
                    similarity_score: 0.95
                  - perfume:
                      brand: "Tom Ford"
                      name: "Oud Wood"
                      sex: "male"
                      image_url: "https://example.com/image2.jpg"
                      properties:
                        perfume_type: "EDP"
                        family: ["Woody", "Oriental"]
                        upper_notes: ["Rosewood"]
                        core_notes: ["Oud"]
                        base_notes: ["Sandalwood", "Vanilla"]
                      shops: []
                    rank: 2
                    similarity_score: 0.88
        "400":
          description: Неверные параметры запроса (отсутствует tags)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                error: "tags are required"
        "403":
          description: Ошибка авторизации (отсутствует или неверный токен)
          content:
            text/plain:
              schema:
                type: string
              example: "authentication error: missing or invalid authorization header"
        "500":
          description: Ошибка взаимодействия с другими сервисами
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                error: "failed to interact with perfume service"

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: token
      description: Bearer токен для внутренней авторизации сервисов
  schemas:
    SuggestResponse:
      type: object
      required:
        - suggested
      properties:
        suggested:
          type: array
          items:
            $ref: "#/components/schemas/RankedPerfume"

    RankedPerfume:
      type: object
      required:
        - perfume
      properties:
        perfume:
          $ref: "#/components/schemas/Perfume"
        rank:
          type: integer
          description: Ранг рекомендации
          example: 1
        similarity_score:
          type: number
          format: float
          description: Оценка схожести (0-1)
          example: 0.95

    Perfume:
      type: object
      required:
        - brand
        - name
        - sex
        - properties
      properties:
        brand:
          type: string
          description: Бренд духов
          example: "Chanel"
        name:
          type: string
          description: Название духов
          example: "No. 5"
        sex:
          type: string
          enum: [male, female, unisex]
          description: Пол
          example: "female"
        image_url:
          type: string
          format: uri
          description: URL изображения
          example: "https://example.com/image.jpg"
        properties:
          $ref: "#/components/schemas/Properties"
        shops:
          type: array
          items:
            $ref: "#/components/schemas/ShopInfo"

    Properties:
      type: object
      required:
        - perfume_type
        - family
        - upper_notes
        - core_notes
        - base_notes
      properties:
        perfume_type:
          type: string
          description: Тип духов (Eau de Parfum, Eau de Toilette, etc.)
          example: "Eau de Parfum"
        family:
          type: array
          items:
            type: string
          description: Семейство аромата
          example: ["Floral", "Aldehydic"]
        upper_notes:
          type: array
          items:
            type: string
          description: Верхние ноты
          example: ["Aldehydes", "Ylang-Ylang"]
        core_notes:
          type: array
          items:
            type: string
          description: Средние ноты
          example: ["Rose", "Jasmine"]
        base_notes:
          type: array
          items:
            type: string
          description: Базовые ноты
          example: ["Vanilla", "Sandalwood"]

    ShopInfo:
      type: object
      required:
        - shop_name
        - domain
        - variants
      properties:
        shop_name:
          type: string
          description: Название магазина
          example: "Gold Apple"
        domain:
          type: string
          description: Домен магазина
          example: "goldapple.ru"
        image_url:
          type: string
          format: uri
          description: URL изображения из магазина
          example: "https://example.com/shop-image.jpg"
        variants:
          type: array
          items:
            $ref: "#/components/schemas/Variant"

    Variant:
      type: object
      required:
        - volume
        - price
        - link
      properties:
        volume:
          type: integer
          description: Объем в миллилитрах
          example: 50
        price:
          type: integer
          description: Цена в рублях
          example: 5000
        link:
          type: string
          format: uri
          description: Ссылка на товар в магазине
          example: "https://goldapple.ru/perfume/123"

    ErrorResponse:
      type: object
      required:
        - error
      properties:
        error:
          type: string
          description: Сообщение об ошибке
          example: "Brand and name are required"
